<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fraud Alerts</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script src="config.js"></script>

    <div class="floating-shape shape1"></div>
    <div class="floating-shape shape2"></div>
    <div class="floating-shape shape3"></div>

    <div class="alerts-container fade-in">
        <h1 class="title">üö® Fraud Alerts</h1>
        <p class="subtitle">Real-time fraud detection results</p>

        <div id="alerts-list"></div>
        <p style="text-align: center; margin-top: 30px;">
            <a href="index.html" class="btn" style="background: #192b4d; color: #00f7ff; box-shadow: 0 0 10px #00f7ff;">‚Üê Back to Dashboard</a>
        </p>
    </div>

    <audio id="alertSound">
        <source src="https://assets.mixkit.co/sfx/download/mixkit-warning-alarm-buzzer-991.wav" type="audio/wav">
    </audio>

<script>
    const synth = window.speechSynthesis;

    function readOutAlert(id, score) {
        if (!synth) return;
        const text = `Warning! Fraud detected. Transaction ID ${id} with a fraud probability score of ${score.toFixed(4)}.`;
        synth.speak(new SpeechSynthesisUtterance(text));
    }

    fetch(`${API_BASE_URL}/alerts`, { headers: { 'Authorization': `Bearer ${token}` } })
    .then(r => {
        if (r.status === 401) throw new Error('Unauthorized');
        return r.json();
    })
    .then(alerts => {
        const list = document.getElementById("alerts-list");
        const sound = document.getElementById("alertSound");

        if (alerts.length > 0) sound.play();

        alerts.forEach(a => {
            const card = document.createElement("div");
            card.className = "alert-card slide-up";
            const date = a.timestamp ? new Date(a.timestamp * 1000) : new Date();
            card.innerHTML = `
                <h3>‚ö†Ô∏è Fraud Detected</h3>
                <p><strong>Transaction ID:</strong> ${a.transaction_id}</p>
                <p><strong>Score:</strong> ${a.score.toFixed(4)}</p>
                <p><strong>Time:</strong> ${date.toLocaleDateString()} ${date.toLocaleTimeString()}</p>
                <button class="btn" style="margin-top: 15px; padding: 8px 15px; font-size: 0.9rem; background: #ff5722;"
                    onclick="readOutAlert(${a.transaction_id}, ${a.score})">
                    üîä Read Alert Details
                </button>`;
            list.appendChild(card);
        });
    })
    .catch(e => {
        if (e.message === 'Unauthorized') {
            alert('Session expired. Please log in again.');
            localStorage.removeItem('access_token');
            window.location.href = 'login.html';
        }
    });
</script>
</body>
</html>
